<!--
   
   Copyright (c) 2020, the Regular Table Authors.
   
   This file is part of the Regular Table library, distributed under the terms of
   the Apache License 2.0.  The full license can be found in the LICENSE file.

-->

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <script src="../dist/umd/regular-table.js"></script>
    <link rel='stylesheet' href="../dist/css/material.css">
    <style>
        .fixed {
            min-width: 80px !important;
        }
    </style>
</head>

<body>

    <regular-table></regular-table>

    <script>
        function createTextContent(text) {
            return Array.from(Array(1000).keys()).map(idx => `${text} ${idx}`);
        }
                
        function createColumnNames(dataset) {
            const columnKey = () => {
                const keys = Object.keys(dataset);
                return [keys[Math.floor(Math.random() * keys.length)]];
            }

            const COLUMN_COUNT = 20;
            return Array.from(Array(COLUMN_COUNT)).map(_ => columnKey());
        }

        function createDataModel () {
            const INDEXED_COLUMN_NAMES = COLUMN_NAMES
                .map((col, idx) => [`${col} ${idx}`]);
            const DATA = COLUMN_NAMES.map(key => DATASET[key]);
        
            return (x0, y0, x1, y1) => {
                const data = DATA.slice(x0, x1).map(col => col.slice(y0, y1));
                const column_indices = INDEXED_COLUMN_NAMES.slice(x0, x1);
                const num_columns = DATA.length;
                const num_rows = DATA[0].length;
                return {
                    num_rows,
                    num_columns,
                    column_indices, 
                    data
                };
            };
        }

        const DATASET = {
            "Fixed Column": createTextContent("Fixed"),
            "Not Set Column": createTextContent("Not set")
        };

        const COLUMN_NAMES = createColumnNames(DATASET);

        
        const tableApi = document.getElementsByTagName('regular-table')[0];

        const fixed_class = 'fixed';

        const clear = (el) => {
            el.classList.remove(fixed_class);
            el.style.minWidth = '';
        }

        const setClass = (el) => {
            const metadata = tableApi.get_meta(el);
            const name = COLUMN_NAMES[metadata.cidx][0];
            if (name.includes("Fixed")) {
                el.classList.add(fixed_class);
            }
        };

        const apply = () => {
            const tds = tableApi.get_tds();
            const ths = tableApi.get_ths();
            for (const tc of [...tds, ...ths]) {
                clear(tc);
                setClass(tc);
            }
        }

        const getDataSliceFn = createDataModel();

        tableApi.setDataModel(getDataSliceFn).then(apply);
        tableApi.addEventListener("regular-table-after-update", apply);
    </script>

</body>
</html>